<!DOCTYPE html>
<html  lang="en">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 4.2.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>NatsumeHill&#39;s blog</title>








<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    
    
    
    
    
    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    
    
    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.svg" alt="NatsumeHill&#39;s blog" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item is-active"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">Archives</a>
                
                <a class="navbar-item"
                href="/tags">Tags</a>
                
                <a class="navbar-item"
                href="/about">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                
                
                <a class="navbar-item search" title="Search" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main">
    
<div class="card">
    
    <div class="card-image">
        <a href="/2019/09/03/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1/" class="image is-7by1">
            <img class="thumbnail" src="/gallery/thumbnails/wallhaven-lmk1vq.png" alt="数据库事务">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-09-03T06:41:55.000Z">2019-09-03</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 minutes read (About 513 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/09/03/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1/">数据库事务</a>
            
        </h1>
        <div class="content">
            Mysql中的InnoDB引擎支持事务,InnoDB支持四个标准定义的事务隔离级别: READ UNCOMMITTED, READ COMMITTED, REPEATABLE READ, and SERIALIZABLE.默认的隔离级别是REPEATABLE READ.
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/2019/09/03/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1/#more">Read More</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-08-29T08:05:43.000Z">2019-08-29</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 minutes read (About 430 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/08/29/Mybatis-Note/">Mybatis Note</a>
            
        </h1>
        <div class="content">
            Mybatis本身具有两级缓存:本地缓存和二级缓存.每当MyBatis创建一个Session时,会自动分配一个本地缓存绑定到Session.在一个Session中的查询操作会被保存到本地缓存,于是当相同的查询语句和相同的参数时,不会直接从数据库中读取数据,而是直接从缓存中获取.
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/2019/08/29/Mybatis-Note/#more">Read More</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-12-01T05:57:05.000Z">2018-12-01</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    18 minutes read (About 2709 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/12/01/openssl-cook-book/">Openssl Cook Book</a>
            
        </h1>
        <div class="content">
            <h1 id="Openssl使用解析"><a href="#Openssl使用解析" class="headerlink" title="Openssl使用解析"></a>Openssl使用解析</h1><h2 id="秘钥生成"><a href="#秘钥生成" class="headerlink" title="秘钥生成"></a>秘钥生成</h2><p>可以使用openssl生成非对称加密秘钥，支持的加密算法包括 <strong>RSA</strong>,<strong>DSA</strong>和<strong>ECDSA</strong>。可使用 <strong>genrsa</strong> 命令生成RSA私钥：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -aes128 -out fd.key 2048</span><br></pre></td></tr></table></figure>

<p>命令输出内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Generating RSA private key, 2048 bit long modulus</span><br><span class="line">........................................................................................................................................................+++</span><br><span class="line">.....................+++</span><br><span class="line">e is 65537 (0x10001)</span><br><span class="line">Enter pass phrase for fd.key:</span><br><span class="line">Verifying - Enter pass phrase for fd.key:</span><br></pre></td></tr></table></figure>

<p>上面的命令指定了使用<strong>AES-128</strong>算法对RSA私钥进行加密。还可以指定其他加密算法，<strong>AES-192</strong>,<strong>AES-256</strong>.</p>
<p>生成的私钥以PEM格式保存到文件中，查看内容大致如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">Proc-Type: 4,ENCRYPTED</span><br><span class="line">DEK-Info: AES-128-CBC,5E99F130761332EC98894B9AA5285050</span><br><span class="line"></span><br><span class="line">1Io5u8+FN5ab67tlWjnZnspdWcgjQeMJYyE6QR2QKmFyUg7pFl8ukh+wtqhFInP5</span><br><span class="line">hv4xmJpJd9sTAr9cT5abD14XtEyj1kBUUx5NZvyJ9bfkyCaoXkL6SG6VSY+cEuxa</span><br><span class="line">[21 lines removes...]</span><br><span class="line">9U2k9ZAdumOKlyEYk2dKkc3c1uC7FuPwNvGsOhJmFfOPqCPVWz7wRG4z4S++jGu4</span><br><span class="line">/tY5xJgUFZP8oKjfHAKfxReoeIA+ULiWaUNTXWydP3jjDKgy5zJ+mI1wT8QBreO3</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure>

<p>我们可以通过使用 <strong>rsa</strong>命令查看私钥的详细结构：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">➜ openssl openssl rsa -text -in fd.key</span><br><span class="line">Enter pass phrase for fd.key:</span><br><span class="line">Private-Key: (2048 bit)</span><br><span class="line">modulus:</span><br><span class="line">    00:eb:33:e5:5f:09:38:f9:12:3f:0f:dc:9d:69:16:</span><br><span class="line">    [...]</span><br><span class="line">publicExponent: 65537 (0x10001)</span><br><span class="line">privateExponent:</span><br><span class="line">    00:c9:c7:9b:e0:0c:69:74:44:d3:15:28:8f:62:b8:</span><br><span class="line">    [...]</span><br><span class="line">prime1:</span><br><span class="line">    00:f9:d6:01:2e:11:c3:ca:fd:22:92:66:c6:7b:df:</span><br><span class="line">    [...]</span><br><span class="line">prime2:</span><br><span class="line">    00:f1:01:77:4c:03:51:44:31:4a:c8:90:24:7f:c2:</span><br><span class="line">    [...]</span><br><span class="line">exponent1:</span><br><span class="line">    00:e5:4a:d7:c2:64:63:81:c5:59:19:6c:61:f6:06:</span><br><span class="line">    [...]</span><br><span class="line">exponent2:</span><br><span class="line">    39:53:b4:f1:d2:d4:30:d9:5c:c5:8a:6b:f4:2b:d6:</span><br><span class="line">    [...]</span><br><span class="line">coefficient:</span><br><span class="line">    67:b4:15:f4:ba:ef:57:bf:95:17:2a:e0:35:8c:d2:</span><br><span class="line">    [...]</span><br><span class="line">writing RSA key</span><br><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">[...]</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure>

<p>我们可以使用 <strong>rsa</strong>命令生成私钥对应的公钥以单独保存：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜ openssl openssl rsa -in fd.key -pubout -out fd_public.key</span><br><span class="line">Enter pass phrase for fd.key:</span><br><span class="line">writing RSA key</span><br></pre></td></tr></table></figure>

<p>原始内容结构如下:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">➜ openssl cat fd_public.key</span><br><span class="line">-----BEGIN PUBLIC KEY-----</span><br><span class="line">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA6zPlXwk4+RI/D9ydaRbt</span><br><span class="line">Nfb7xB1765vsAd5XOwFi3+oqAQnkmyea5h4lm5C53xcve+U/SXDiZaijxx2meTeQ</span><br><span class="line">Uz7hN5eUgqWgnGexFYMER9WAqzr4VGoesz4NNo8snHLlw7osaWHxvqO930JElb5g</span><br><span class="line">pRYs+H0L9Xy1vA6Zg6LBxj89xPEhttfmkWxL2FTBsL5hzlYjYJDmLy/MJsUbmoNs</span><br><span class="line">8WncX9ItG3CZb8FBhVVcmbXravJ/HDEjJvonkdJZa1iBkJSy0DCeeLbeCwXY6uf+</span><br><span class="line">83IQwzs70uL3I4qRQg4CyzhLUAt6EDsIdgTkjJv0mtFnbTV6kVswRQFymMu6I18L</span><br><span class="line">hwIDAQAB</span><br><span class="line">-----END PUBLIC KEY-----</span><br></pre></td></tr></table></figure>

<h2 id="创建CA签名请求"><a href="#创建CA签名请求" class="headerlink" title="创建CA签名请求"></a>创建CA签名请求</h2><p>当我们生成了私钥之后，可以用私钥继续创建<em>Certification Signing Request（CSR）</em>。这是一个要求CA签署证书的正式请求，它包含请求证书的实体的公钥和有关该实体的一些信息。这些数据都将成为证书的一部分。 CSR会被与起承载的公钥（实体的公钥）对应的私钥加密。</p>
<p>CSR创建通常是一个交互式过程，在此过程中您将提供证书专有名称的元素.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">➜ openssl openssl req -new -key fd.key -out fd.csr</span><br><span class="line">Enter pass phrase for fd.key:</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter '.', the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [AU]:CN</span><br><span class="line">State or Province Name (full name) [Some-State]:JS</span><br><span class="line">Locality Name (eg, city) []:SZ</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:USTC</span><br><span class="line">Organizational Unit Name (eg, section) []:IT Department</span><br><span class="line">Common Name (e.g. server FQDN or YOUR name) []:www.test.com</span><br><span class="line">Email Address []:fangkui@ustc.edu.cn</span><br><span class="line"></span><br><span class="line">Please enter the following 'extra' attributes</span><br><span class="line">to be sent with your certificate request</span><br><span class="line">A challenge password []:</span><br><span class="line">An optional company name []:</span><br></pre></td></tr></table></figure>

<p>生成请求成功后，我们可以查看请求具体信息：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">➜ openssl openssl req -text -in fd.csr -noout</span><br><span class="line">Certificate Request:</span><br><span class="line">    Data:</span><br><span class="line">        Version: 0 (0x0)</span><br><span class="line">        Subject: C=CN, ST=JS, L=SZ, O=USTC, OU=IT Department, CN=www.test.com/emailAddress=fangkui@ustc.edu.cn</span><br><span class="line">        Subject Public Key Info:</span><br><span class="line">            Public Key Algorithm: rsaEncryption</span><br><span class="line">                Public-Key: (2048 bit)</span><br><span class="line">                Modulus:</span><br><span class="line">                    00:eb:33:e5:5f:09:38:f9:12:3f:0f:dc:9d:69:16:</span><br><span class="line">                    [16 more lines ...]</span><br><span class="line">                    0b:87</span><br><span class="line">                Exponent: 65537 (0x10001)</span><br><span class="line">        Attributes:</span><br><span class="line">            a0:00</span><br><span class="line">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">         23:29:3f:65:68:f7:f2:3d:4d:c1:98:f4:96:ac:5c:f9:da:45:</span><br><span class="line">         [13 more lines...]</span><br><span class="line">         f1:5f:72:ce</span><br></pre></td></tr></table></figure>

<p>如果您要续订证书并且不想对其中显示的信息进行任何更改，则可以为自己节省一些输入。 使用以下命令，您可以从现有证书创建全新的CSR：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -x509toreq -in fd.crt -out fd.csr -signkey fd.key</span><br></pre></td></tr></table></figure>

<h3 id="无人值守的CSR生成"><a href="#无人值守的CSR生成" class="headerlink" title="无人值守的CSR生成"></a>无人值守的CSR生成</h3><p>可以提供一个自定义的配置文件来替代交互式的CSR创建过程。比如创建一个如下内容的配置文件 <strong>fd.cnf</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[req]</span><br><span class="line">prompt &#x3D; no</span><br><span class="line">distinguished_name &#x3D; dn</span><br><span class="line">req_extensions &#x3D; ext</span><br><span class="line">input_password &#x3D; PASSPHRASE</span><br><span class="line">[dn]</span><br><span class="line">CN &#x3D; www.feistyduck.com</span><br><span class="line">emailAddress &#x3D; webmaster@feistyduck.com</span><br><span class="line">O &#x3D; Feisty Duck Ltd</span><br><span class="line">L &#x3D; London</span><br><span class="line">C &#x3D; GB</span><br><span class="line">[ext]</span><br><span class="line">subjectAltName &#x3D; DNS:www.feistyduck.com,DNS:feistyduck.com</span><br></pre></td></tr></table></figure>

<p>然后可以直接创建CSR：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -config fd.cnf -key fd.key -out fd.csr</span><br></pre></td></tr></table></figure>

<h2 id="自签名证书"><a href="#自签名证书" class="headerlink" title="自签名证书"></a>自签名证书</h2><p>如果您要为自己的用途安装TLS服务器，则可能不希望前往CA获取公开信任的证书。 使用自签名证书要容易得多。 如果您是Firefox用户，则在首次访问该网站时，您可以创建证书例外，之后该站点将像使用公开信任的证书一样受到保护。 如果您已有CSR，请使用以下命令创建证书：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜ openssl openssl x509 -req -days 356 -in fd.csr -signkey fd.key -out fd.crt</span><br><span class="line">Signature ok</span><br><span class="line">subject=/C=CN/ST=JS/L=SZ/O=USTC/OU=IT Department/CN=www.test.com/emailAddress=fangkui@ustc.edu.cn</span><br><span class="line">Getting Private key</span><br><span class="line">Enter pass phrase for fd.key:</span><br></pre></td></tr></table></figure>

<p>如果只是创建自签名证书，可以不用单独创建一个CSR，直接通过一条命令就可以生成证书：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">➜ openssl openssl req -new -x509 -days 365 -key fd.key -out fd.crt</span><br><span class="line">Enter pass phrase for fd.key:</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter '.', the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [AU]:CN</span><br><span class="line">State or Province Name (full name) [Some-State]:JS</span><br><span class="line">Locality Name (eg, city) []:SZ</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:USTC</span><br><span class="line">Organizational Unit Name (eg, section) []:IT dp</span><br><span class="line">Common Name (e.g. server FQDN or YOUR name) []:localhost</span><br><span class="line">Email Address []:fangkui@ustc.edu.cn</span><br></pre></td></tr></table></figure>

<p>使用如下命令查看证书内容：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">➜ openssl openssl x509 -text -in fd.crt -noout</span><br><span class="line">Certificate:</span><br><span class="line">    Data:</span><br><span class="line">        Version: 3 (0x2)</span><br><span class="line">        Serial Number:</span><br><span class="line">            cf:71:94:b4:1e:57:ac:df</span><br><span class="line">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">        Issuer: C=CN, ST=JS, L=SZ, O=USTC, OU=IT dp, CN=localhost/emailAddress=fangkui@ustc.edu.cn</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Dec  1 06:53:15 2018 GMT</span><br><span class="line">            Not After : Dec  1 06:53:15 2019 GMT</span><br><span class="line">        Subject: C=CN, ST=JS, L=SZ, O=USTC, OU=IT dp, CN=localhost/emailAddress=fangkui@ustc.edu.cn</span><br><span class="line">        Subject Public Key Info:</span><br><span class="line">            Public Key Algorithm: rsaEncryption</span><br><span class="line">                Public-Key: (2048 bit)</span><br><span class="line">                Modulus:</span><br><span class="line">                    00:eb:33:e5:5f:09:38:f9:12:3f:0f:dc:9d:69:16:</span><br><span class="line">                    [...]</span><br><span class="line">                    0b:87</span><br><span class="line">                Exponent: 65537 (0x10001)</span><br><span class="line">        X509v3 extensions:</span><br><span class="line">            X509v3 Subject Key Identifier:</span><br><span class="line">                79:6F:A9:1A:88:E9:4C:73:B3:0A:E3:6F:70:B5:70:68:33:71:63:22</span><br><span class="line">            X509v3 Authority Key Identifier:</span><br><span class="line">                keyid:79:6F:A9:1A:88:E9:4C:73:B3:0A:E3:6F:70:B5:70:68:33:71:63:22</span><br><span class="line"></span><br><span class="line">            X509v3 Basic Constraints:</span><br><span class="line">                CA:TRUE</span><br><span class="line">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">         61:68:e0:a1:36:d5:6a:97:35:b3:f9:7d:a2:5c:08:ab:20:14:</span><br><span class="line">         [...]</span><br><span class="line">         39:00:7e:83</span><br></pre></td></tr></table></figure>

<h2 id="创建对多个域名有效的证书"><a href="#创建对多个域名有效的证书" class="headerlink" title="创建对多个域名有效的证书"></a>创建对多个域名有效的证书</h2><p>有两种方式可以实现一个证书对多个域名有效：</p>
<ul>
<li>使用X.509提供的 <em>Subject Alternative Name</em>扩展罗列出所有的域名；</li>
<li>使用通配符（e.g., feistyduck.com and *.feistyduck.com）；</li>
</ul>
<p>自签名证书通常只包含最基本的证书数据，如上例所示。相比之下，公共CA颁发的证书更有趣，因为它们包含许多其他字段（通过X.509扩展机制）。</p>
<p><em>Basic Constraints</em>扩展用于将证书标记为属于CA，并给予它们签署其他证书的能力。非CA证书将省略此扩展名，或将CA的值设置为FALSE。 这种扩展很关键，这意味着所有软件必须理解其含义。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X509v3 Basic Constraints: critical</span><br><span class="line">    CA:FALSE</span><br></pre></td></tr></table></figure>

<p><em>Key Usage（KU）</em>和 <em>Extended Key Usage（EKU）</em>扩展限制了证书的用途。如果存在这些扩展名，则仅允许列出的用途。如果扩展名不存在，则没有使用限制。您在此示例中看到的是Web服务器证书的典型内容，例如，它不允许进行代码签名：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">X509v3 Key Usage: critical</span><br><span class="line">    Digital Signature, Key Encipherment</span><br><span class="line">X509v3 Extended Key Usage:</span><br><span class="line">    TLS Web Server Authentication, TLS Web Client Authentication</span><br></pre></td></tr></table></figure>

<p><em>CRL Distribution Points</em>扩展列出了可以找到CA的证书吊销列表（CRL）信息的地址。 在需要撤销证书的情况下，此信息非常重要。 CRL是经过CA签名的撤销证书列表，以定期时间间隔（例如，七天）发布。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">X509v3 CRL Distribution Points:</span><br><span class="line">Full Name:</span><br><span class="line">    URI:http:&#x2F;&#x2F;crl.starfieldtech.com&#x2F;sfs3-20.crl</span><br></pre></td></tr></table></figure>

<p><em>Certificate Policies</em>扩展用于指示颁发证书的策略。 例如，这是可以找到*extended validation *（EV）指标的地方（如以下示例）。 指示符采用唯一对象标识符（OID）的形式，并且它们对于颁发CA是唯一的。 此外，此扩展通常包含一个或多个证书策略声明（CPS）点，通常是网页或PDF文档。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">X509v3 Certificate Policies:</span><br><span class="line">    Policy: 2.16.840.1.114414.1.7.23.3</span><br><span class="line">    CPS: http:&#x2F;&#x2F;certificates.starfieldtech.com&#x2F;repository&#x2F;</span><br></pre></td></tr></table></figure>

<p><em>Authority Information Access</em>（AIA）扩展通常包含两个重要信息。 首先，它列出了CA的在线证书状态协议（OCSP）响应程序的地址，该响应程序可用于实时检查证书撤销。 该扩展还可以包含指向发行人证书（链中的下一个证书）的位置的链接。 目前，服务器证书很少直接由受信任的根证书签名，这意味着用户必须在其配置中包含一个或多个中间证书。 错误很容易使证书无效。 某些客户端（例如，Internet Explorer）将使用此扩展中提供的信息来修复不完整的证书链，但许多客户端不会。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Authority Information Access:</span><br><span class="line">    OCSP - URI:http:&#x2F;&#x2F;ocsp.starfieldtech.com&#x2F;</span><br><span class="line">    CA Issuers - URI:http:&#x2F;&#x2F;certificates.starfieldtech.com&#x2F;repository&#x2F;sf…</span><br><span class="line">    _intermediate.crt</span><br></pre></td></tr></table></figure>

<p><em>Subject Key Identifier</em>和<em>Authority Key Identifier</em>扩展分别建立唯一的拥有者和授权密钥标识符。证书的Authority Key Identifier扩展中指定的值必须与颁发证书中Subject Key Identifier扩展中指定的值匹配。此信息在证书路径构建过程中非常有用，其中客户端尝试查找从叶（服务器）证书到受信任根的所有可能路径。证书颁发机构通常会使用一个带有多个证书的私钥，该字段允许软件可靠地识别哪个证书可以与哪个密钥匹配。在现实世界中，服务器提供的许多证书链都是无效的，但这一事实经常被忽视，因为浏览器能够找到替代的信任路径。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">X509v3 Subject Key Identifier:</span><br><span class="line">    4A:AB:1C:C3:D3:4E:F7:5B:2B:59:71:AA:20:63:D6:C9:40:FB:14:F1</span><br><span class="line">X509v3 Authority Key Identifier:</span><br><span class="line">    keyid:49:4B:52:27:D1:1B:BC:F2:A1:21:6A:62:7B:51:42:7A:8A:D7:D5:56</span><br></pre></td></tr></table></figure>

<p>最后，使用<em>Subject Alternative Name</em>扩展名列出证书有效的所有主机名。此扩展程序曾经是可选的; 如果它不存在，客户端将回退到使用Common Name（CN）中提供的信息，该名称是“<strong>subject</strong>”字段的一部分。 如果存在扩展名，则在验证期间忽略CN字段的内容。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X509v3 Subject Alternative Name:</span><br><span class="line">    DNS:www.feistyduck.com, DNS:feistyduck.com</span><br></pre></td></tr></table></figure>
        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-08-28T12:17:59.000Z">2018-08-28</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    8 minutes read (About 1127 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/08/28/Docker%E5%85%A5%E9%97%A8-%E7%AC%AC%E5%9B%9B%E7%AF%87%EF%BC%88Swarms%EF%BC%89/">Docker入门-第四篇（Swarms）</a>
            
        </h1>
        <div class="content">
            <h1 id="搭建Swarm集群"><a href="#搭建Swarm集群" class="headerlink" title="搭建Swarm集群"></a>搭建Swarm集群</h1><h2 id="Swarm简介"><a href="#Swarm简介" class="headerlink" title="Swarm简介"></a>Swarm简介</h2><p><strong>Swarm</strong>指一组运行Docker并加入群集的计算机。针对一个Swarm，之前使用的Docker命令，现在由<strong>Swarm Manager</strong>在群集上执行。Swarm中的机器可以是物理的或虚拟的。加入群组后，它们被称为节点。</p>
<p>Swarm管理器可以使用多种策略来运行容器，例如“emptiest node” —— 它使用容器填充利用率最低的机器。或“global”，它确保每台机器只获得指定容器的一个实例。您可以指示Swarm Manager使用Compose文件中配置的策略，正如在上一篇文章所描述的那样。</p>
<p>Swarm Manager是Swarm中唯一可以执行命令的机器，或授权其他机器作为Worker加入Swarm。worker只是在那里提供资源，并且没有权力告诉任何其他机器它能做什么和不能做什么。</p>
<p>到目前为止，我们一直在本地计算机上以单主机模式使用Docker。但是Docker也可以切换到swarm模式。立即启用swarm mod使当前计算机成为swarm manager。这样，Docker就会运行您在管理的swarm上执行的命令，而不仅仅是在当前机器上。</p>
<h2 id="创建Swarm"><a href="#创建Swarm" class="headerlink" title="创建Swarm"></a>创建Swarm</h2><p>一个Swarm由多个节点组成，这些节点可以是物理的计算机，也可以是虚拟的。最简单的方式是使用命令 <strong>docker swarm init</strong>初始化当前计算机为swarm manager。然后让其他计算机加入到创建的swarm。另一中方式是创建虚拟的swarm。这里我们创建一个具有两个虚拟节点的swarm。</p>
<ol>
<li><p>创建虚拟节点</p>
<p> 使用 <strong>docker-machine</strong>工具创建两个虚拟节点：</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-machine create --driver virtualbox myvm1</span><br><span class="line">docker-machine create --driver virtualbox myvm2</span><br></pre></td></tr></table></figure></li>
<li><p>初始化swarm并添加节点</p>
<p> 将myvm1配置为swarm manager，用于执行management commands，注册worker。设置myvm2为worker。</p>
<p> 这里，利用命令 <strong>docker-machine ssh</strong>发送指令给虚拟机。</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker-machine ssh myvm1 <span class="string">"docker swarm init --advertise-addr &lt;myvm1 ip&gt;"</span></span></span><br><span class="line">Swarm initialized: current node &lt;node ID&gt; is now a manager.</span><br><span class="line"></span><br><span class="line">To add a worker to this swarm, run the following command:</span><br><span class="line"></span><br><span class="line">docker swarm join \</span><br><span class="line">--token &lt;token&gt; \</span><br><span class="line">&lt;myvm ip&gt;:&lt;port&gt;</span><br><span class="line"></span><br><span class="line">To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.</span><br></pre></td></tr></table></figure>

<p> 注意替换ip地址。然后将myvm2添加到swarm中：</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker-machine ssh myvm2 <span class="string">"docker swarm join \</span></span></span><br><span class="line">--token &lt;token&gt; \</span><br><span class="line">&lt;ip&gt;:2377"</span><br><span class="line"></span><br><span class="line">This node joined a swarm as a worker.</span><br></pre></td></tr></table></figure>
</li>
<li><p>部署App到Swarm</p>
<p>首先，需要切换环境变量，以便使用shell发送指令给swarm manager：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval $(docker-machine env myvm1)</span><br></pre></td></tr></table></figure>

<p>跟前一篇文章类似，使用以下命令部署app：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stack deploy -c docker-compose.yml getstartedlab</span><br></pre></td></tr></table></figure>

<p>需要注意的是，我们前面创建的镜像并没有注册到远程镜像库，所以使用上面的命令部署app，会找不到镜像。可以通过在myvm1,myvm2中分别构建镜像来解决这个问题。</p>
</li>
</ol>
<h2 id="Cleanup-and-reboot"><a href="#Cleanup-and-reboot" class="headerlink" title="Cleanup and reboot"></a>Cleanup and reboot</h2><h3 id="Stacks-and-swarms"><a href="#Stacks-and-swarms" class="headerlink" title="Stacks and swarms"></a>Stacks and swarms</h3><p>可以使用一下命令关闭stack：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stack rm getstartedlab</span><br></pre></td></tr></table></figure>

<h3 id="恢复环境变量"><a href="#恢复环境变量" class="headerlink" title="恢复环境变量"></a>恢复环境变量</h3><p>可以通过以下命令恢复环境变量：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval $(docker-machine env -u)</span><br></pre></td></tr></table></figure>

<h2 id="Recap-and-cheat-sheet-optional"><a href="#Recap-and-cheat-sheet-optional" class="headerlink" title="Recap and cheat sheet (optional)"></a>Recap and cheat sheet (optional)</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">docker-machine create --driver virtualbox myvm1 # Create a VM (Mac, Win7, Linux)</span><br><span class="line">docker-machine create -d hyperv --hyperv-virtual-switch "myswitch" myvm1 # Win10</span><br><span class="line">docker-machine env myvm1                # View basic information about your node</span><br><span class="line">docker-machine ssh myvm1 "docker node ls"         # List the nodes in your swarm</span><br><span class="line">docker-machine ssh myvm1 "docker node inspect &lt;node ID&gt;"        # Inspect a node</span><br><span class="line">docker-machine ssh myvm1 "docker swarm join-token -q worker"   # View join token</span><br><span class="line">docker-machine ssh myvm1   # Open an SSH session with the VM; type "exit" to end</span><br><span class="line">docker node ls                # View nodes in swarm (while logged on to manager)</span><br><span class="line">docker-machine ssh myvm2 "docker swarm leave"  # Make the worker leave the swarm</span><br><span class="line">docker-machine ssh myvm1 "docker swarm leave -f" # Make master leave, kill swarm</span><br><span class="line">docker-machine ls # list VMs, asterisk shows which VM this shell is talking to</span><br><span class="line">docker-machine start myvm1            # Start a VM that is currently not running</span><br><span class="line">docker-machine env myvm1      # show environment variables and command for myvm1</span><br><span class="line">eval $(docker-machine env myvm1)         # Mac command to connect shell to myvm1</span><br><span class="line">&amp; "C:\Program Files\Docker\Docker\Resources\bin\docker-machine.exe" env myvm1 | Invoke-Expression   # Windows command to connect shell to myvm1</span><br><span class="line">docker stack deploy -c &lt;file&gt; &lt;app&gt;  # Deploy an app; command shell must be set to talk to manager (myvm1), uses local Compose file</span><br><span class="line">docker-machine scp docker-compose.yml myvm1:~ # Copy file to node's home dir (only required if you use ssh to connect to manager and deploy the app)</span><br><span class="line">docker-machine ssh myvm1 "docker stack deploy -c &lt;file&gt; &lt;app&gt;"   # Deploy an app using ssh (you must have first copied the Compose file to myvm1)</span><br><span class="line">eval $(docker-machine env -u)     # Disconnect shell from VMs, use native docker</span><br><span class="line">docker-machine stop $(docker-machine ls -q)               # Stop all running VMs</span><br><span class="line">docker-machine rm $(docker-machine ls -q) # Delete all VMs and their disk images</span><br></pre></td></tr></table></figure>

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><blockquote>
<p><a href="https://docs.docker.com/get-started/part4/#recap-and-cheat-sheet-optional">https://docs.docker.com/get-started/part4/#recap-and-cheat-sheet-optional</a></p>
</blockquote>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-08-28T09:51:19.000Z">2018-08-28</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    9 minutes read (About 1393 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/08/28/Docker%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%89%E7%AF%87%EF%BC%88Services%EF%BC%89/">Docker入门-第三篇（Services）</a>
            
        </h1>
        <div class="content">
            <h1 id="以服务方式运行容器"><a href="#以服务方式运行容器" class="headerlink" title="以服务方式运行容器"></a>以服务方式运行容器</h1><h2 id="About-services"><a href="#About-services" class="headerlink" title="About services"></a>About services</h2><p>在分布式应用程序中，应用程序的不同部分称为“服务”。例如，想象一个视频共享站点，它可能包括一个用于将应用程序数据存储在数据库中的服务，一个用于在后台进行视频转码的服务。用户上传内容，前端服务等。服务实际上只是“生产环境中的容器”。服务只运行一个映像，但它编码了映像的运行方式 —— 它应该使用哪些端口，应该运行多少个容器副本，以便服务具有所需的容量等等。扩展服务会更改运行该软件的容器实例的数量，从而为流程中的服务分配更多计算资源。幸运的是，使用Docker平台定义，运行和扩展服务非常容易 —— 只需编写一个docker-compose.yml文件即可。</p>
<p>##　创建第一个docker-compose.yml</p>
<p>docker-compose.yml文件是一个YAML文件，用于定义Docker容器在生产环境中的行为方式。</p>
<p><strong>docker-compose.yml</strong></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3"</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="comment"># replace username/repo:tag with your name and image details</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">username/repo:tag</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">replicas:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">limits:</span></span><br><span class="line">          <span class="attr">cpus:</span> <span class="string">"0.1"</span></span><br><span class="line">          <span class="attr">memory:</span> <span class="string">50M</span></span><br><span class="line">      <span class="attr">restart_policy:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">on-failure</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"4000:80"</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">webnet</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">webnet:</span></span><br></pre></td></tr></table></figure>

<p>你可以将docker-compose.yml保存到任何地方。确保文件中的镜像名username/repo:tag替换为你想要的镜像，这个镜像是在镜像库中注册过的。</p>
<p>这个docker-compose.yml文件告诉Docker执行以下操作：</p>
<ul>
<li>从注册表中提取镜像；</li>
<li>将该镜像的5个实例作为名为web的服务运行，限制每个实例使用最多10％的CPU（跨所有核心）和50MB的RAM;</li>
<li>如果一个失败，立即重启容器;</li>
<li>将主机上的端口4000映射到Web的端口80;</li>
<li>指示Web容器通过称为webnet的负载平衡网络共享端口80.（在内部，容器本身在短暂的端口发布到web的端口80.）</li>
<li>使用默认设置（负载平衡的覆盖网络）定义Webnet网络.</li>
</ul>
<h2 id="运行负载均衡后的App"><a href="#运行负载均衡后的App" class="headerlink" title="运行负载均衡后的App"></a>运行负载均衡后的App</h2><p>在我们使用docker stack deploy命令之前，我们首先运行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm init</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note: 后面的文章中会详细介绍　<strong>swarm</strong>。如果您没有运行docker swarm init，则会收到“this node is not a swarm manager.”错误。</p>
</blockquote>
<p>现在可以运行这个应用了。您需要为您的应用程序命名。在这里，它被设置为getstartedlab：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stack deploy -c docker-compose.yml getstartedlab</span><br></pre></td></tr></table></figure>

<p>我们的单个服务堆栈在一台主机上运行已部署了镜像的5个容器实例。通过一下方式，可以查看服务的ID:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker service ls</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########OUT PUT:</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> fangkui@fangkui-linux: ~/tmp                                                                                                             (18:09:24)  </span></span><br><span class="line">ζ docker service ls</span><br><span class="line"></span><br><span class="line">ID                  NAME                MODE                REPLICAS            IMAGE                  PORTS</span><br><span class="line">j6c3ps594ky1        getstartedlab_web   replicated          5/5                 friendlyhello:latest   *:4000-&gt;80/tcp</span><br></pre></td></tr></table></figure>

<p>在服务中运行的单个容器称为任务。任务被赋予以数字递增的唯一ID，最多为您在docker-compose.yml中定义的副本数。列出您的服务任务：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">docker service ps getstartedlab_web</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#########OUT PUT############</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> fangkui@fangkui-linux: ~/tmp                                                                                                             (18:09:26)  </span></span><br><span class="line">ζ docker service ps getstartedlab_web</span><br><span class="line"></span><br><span class="line">ID                  NAME                  IMAGE                  NODE                DESIRED STATE       CURRENT STATE           ERROR               PORTS</span><br><span class="line">owxqt9zjb4hb        getstartedlab_web.1   friendlyhello:latest   fangkui-linux       Running             Running 2 minutes ago                       </span><br><span class="line">z5lm26k0ar4u        getstartedlab_web.2   friendlyhello:latest   fangkui-linux       Running             Running 2 minutes ago                       </span><br><span class="line">n4p8qtrhiegy        getstartedlab_web.3   friendlyhello:latest   fangkui-linux       Running             Running 2 minutes ago                       </span><br><span class="line">npzdltqqw9gb        getstartedlab_web.4   friendlyhello:latest   fangkui-linux       Running             Running 2 minutes ago                       </span><br><span class="line">n805z6c2smxn        getstartedlab_web.5   friendlyhello:latest   fangkui-linux       Running             Running 2 minutes ago</span><br></pre></td></tr></table></figure>

<p>如果您只列出系统上的所有容器，则任务也会显示，但不会被服务过滤：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> fangkui@fangkui-linux: ~/tmp                                                                                                             (18:11:57)  </span></span><br><span class="line">ζ docker container ls                                                                                                                                       </span><br><span class="line">CONTAINER ID        IMAGE                  COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">0c06e54d2901        friendlyhello:latest   "python app.py"     3 minutes ago       Up 3 minutes        80/tcp              getstartedlab_web.4.npzdltqqw9gbgailbd7o09xcu</span><br><span class="line">64165df37b26        friendlyhello:latest   "python app.py"     3 minutes ago       Up 3 minutes        80/tcp              getstartedlab_web.1.owxqt9zjb4hbgc1zw5r00wzr2</span><br><span class="line">fadfb984875b        friendlyhello:latest   "python app.py"     3 minutes ago       Up 3 minutes        80/tcp              getstartedlab_web.5.n805z6c2smxnmuuqf8runhnnd</span><br><span class="line">c00f89869c3e        friendlyhello:latest   "python app.py"     3 minutes ago       Up 3 minutes        80/tcp              getstartedlab_web.2.z5lm26k0ar4ua9b36qbkql0uy</span><br><span class="line">28fe2522ca5c        friendlyhello:latest   "python app.py"     3 minutes ago       Up 3 minutes        80/tcp              getstartedlab_web.3.n4p8qtrhiegyrhzbju7omemy3</span><br></pre></td></tr></table></figure>

<p>您可以连续多次运行curl -4 http：// localhost：4000，或者在浏览器中转到该URL并点击刷新几次。</p>
<p>无论哪种方式，容器ID都会发生变化，从而证明负载均衡;对于每个请求，以循环方式选择5个任务中的一个来响应。容器ID与上一个命令（docker container ls -q）的输出匹配。</p>
<h2 id="扩展App"><a href="#扩展App" class="headerlink" title="扩展App"></a>扩展App</h2><p>您可以通过更改docker-compose.yml中的副本值来保存更改，并重新运行docker stack deploy命令来扩展应用程序：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stack deploy -c docker-compose.yml getstartedlab</span><br></pre></td></tr></table></figure>

<p>Docker执行就地更新，无需首先拆除堆栈或杀死任何容器。现在，重新运行docker container ls -q以查看已重新配置的已部署实例。如果放大副本，则会启动更多任务，从而启动更多容器。</p>
<h2 id="关闭App和Swarm"><a href="#关闭App和Swarm" class="headerlink" title="关闭App和Swarm"></a>关闭App和Swarm</h2><p>关闭App:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stack rm getstartedlab</span><br></pre></td></tr></table></figure>

<p>关闭swarm:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm leave --force</span><br></pre></td></tr></table></figure>

<h2 id="Recap-and-cheat-sheet-optional"><a href="#Recap-and-cheat-sheet-optional" class="headerlink" title="Recap and cheat sheet (optional)"></a>Recap and cheat sheet (optional)</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker stack ls                                            # List stacks or apps</span><br><span class="line">docker stack deploy -c &lt;composefile&gt; &lt;appname&gt;  # Run the specified Compose file</span><br><span class="line">docker service ls                 # List running services associated with an app</span><br><span class="line">docker service ps &lt;service&gt;                  # List tasks associated with an app</span><br><span class="line">docker inspect &lt;task or container&gt;                   # Inspect task or container</span><br><span class="line">docker container ls -q                                      # List container IDs</span><br><span class="line">docker stack rm &lt;appname&gt;                             # Tear down an application</span><br><span class="line">docker swarm leave --force      # Take down a single node swarm from the manager</span><br></pre></td></tr></table></figure>

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><blockquote>
<p><a href="https://docs.docker.com/get-started/part3/#recap-and-cheat-sheet-optional">https://docs.docker.com/get-started/part3/#recap-and-cheat-sheet-optional</a></p>
</blockquote>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-08-28T08:47:05.000Z">2018-08-28</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    8 minutes read (About 1259 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/08/28/Docker%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%BA%8C%E7%AF%87%EF%BC%88Container%EF%BC%89/">Docker入门-第二篇（Container）</a>
            
        </h1>
        <div class="content">
            <h1 id="创建自己的Docker镜像"><a href="#创建自己的Docker镜像" class="headerlink" title="创建自己的Docker镜像"></a>创建自己的Docker镜像</h1><h2 id="变化"><a href="#变化" class="headerlink" title="变化"></a>变化</h2><p>在过去，如果您要开始编写Python应用程序，那么您的第一个任务是在您的计算机上安装Python运行时。但是，这会导致您的计算机上的环境需要非常适合您的应用程序按预期运行，并且还需要与您的生产环境相匹配。</p>
<p>使用Docker，您可以将可移植的Python运行时作为镜像，无需安装。您可以在构建的过程中，将应用及其依赖的基础python镜像打包，确保应用可以正确运行。</p>
<p>这些可移植镜像由称为<strong>Dockerfile</strong>的文件定义。</p>
<h2 id="利用Dockerfile创建容器"><a href="#利用Dockerfile创建容器" class="headerlink" title="利用Dockerfile创建容器"></a>利用Dockerfile创建容器</h2><p>Dockerfile定义容器内环境中发生的事情。对网络接口和磁盘驱动器等资源的访问在此环境中进行虚拟化，该环境与系统的其他部分隔离，因此您需要将端口映射到外部世界，并具体说明要“复制”哪些文件到容器环境。但是，执行此操作后，您可以预期此Dockerfile中定义的应用程序的构建在其运行的任何位置都会完全相同。</p>
<h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><p>创建一个空目录。将目录（cd）更改为新目录，创建名为Dockerfile的文件，将以下内容复制并粘贴到该文件中，然后保存：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Use an official Python runtime as a parent image</span></span><br><span class="line"><span class="keyword">FROM</span> python:<span class="number">2.7</span>-slim</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the working directory to /app</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Copy the current directory contents into the container at /app</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> . /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Install any needed packages specified in requirements.txt</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> pip install --trusted-host pypi.python.org -r requirements.txt</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Make port 80 available to the world outside this container</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define environment variable</span></span><br><span class="line"><span class="keyword">ENV</span> NAME World</span><br><span class="line"></span><br><span class="line"><span class="comment"># Run app.py when the container launches</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"python"</span>, <span class="string">"app.py"</span>]</span></span><br></pre></td></tr></table></figure>

<p>这个Dockerfile引用了我们尚未创建的几个文件，即app.py和requirements.txt。接下来创建这个两个文件。</p>
<h3 id="应用实现"><a href="#应用实现" class="headerlink" title="应用实现"></a>应用实现</h3><p>在这里，我们继续创建两个文件，分别为requirements.txt，app.py。app.py是应用程序业务逻辑的实现，requirements.txt中的内容是应用所依赖的python包。将这两个文件放在与Dockerfile的同一个文件夹下。两个文件内容如下：</p>
<p><strong>requirements.txt</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Flask</span><br><span class="line">Redis</span><br></pre></td></tr></table></figure>

<p><strong>app.py</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> redis <span class="keyword">import</span> Redis, RedisError</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># Connect to Redis</span></span><br><span class="line">redis = Redis(host=<span class="string">"redis"</span>, db=<span class="number">0</span>, socket_connect_timeout=<span class="number">2</span>, socket_timeout=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route("/")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        visits = redis.incr(<span class="string">"counter"</span>)</span><br><span class="line">    <span class="keyword">except</span> RedisError:</span><br><span class="line">        visits = <span class="string">"&lt;i&gt;cannot connect to Redis, counter disabled&lt;/i&gt;"</span></span><br><span class="line"></span><br><span class="line">    html = <span class="string">"&lt;h3&gt;Hello &#123;name&#125;!&lt;/h3&gt;"</span> \</span><br><span class="line">           <span class="string">"&lt;b&gt;Hostname:&lt;/b&gt; &#123;hostname&#125;&lt;br/&gt;"</span> \</span><br><span class="line">           <span class="string">"&lt;b&gt;Visits:&lt;/b&gt; &#123;visits&#125;"</span></span><br><span class="line">    <span class="keyword">return</span> html.format(name=os.getenv(<span class="string">"NAME"</span>, <span class="string">"world"</span>), hostname=socket.gethostname(), visits=visits)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>, port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure>

<p>现在我们看到pip install -r requirements.txt为Python安装了Flask和Redis库，应用程序打印环境变量NAME，以及对socket.gethostname（）的调用输出。最后，因为Redis没有运行（因为我们只安装了Python库，而不是Redis本身），这样在尝试使用Redis时会抛出错误。</p>
<h3 id="构建应用"><a href="#构建应用" class="headerlink" title="构建应用"></a>构建应用</h3><p>现在我们已经准备好构建应用程序。确保您仍处于新目录的顶层。确保当你执行 <strong>ls</strong> 命令时，输出内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ls</span></span><br><span class="line">Dockerfile		app.py			requirements.txt</span><br></pre></td></tr></table></figure>

<p>现在运行build命令。这将创建一个Docker镜像，这里使用 -t 参数为新构建的镜像命名。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t friendlyhello .</span><br></pre></td></tr></table></figure>

<p>现在可以在本地Docker镜像库中查看到我们构建的镜像：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> fangkui@fangkui-linux: ~/tmp</span></span><br><span class="line">ζ docker images</span><br><span class="line"></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">friendlyhello       latest              8c89b7cb2e32        3 days ago          132MB</span><br><span class="line">python              2.7-slim            40792d8a2d6d        3 weeks ago         120MB</span><br><span class="line">hello-world         latest              2cb0d9787c4d        6 weeks ago         1.85kB</span><br></pre></td></tr></table></figure>

<h3 id="运行创建的镜像"><a href="#运行创建的镜像" class="headerlink" title="运行创建的镜像"></a>运行创建的镜像</h3><p>运行应用程序，使用-p将计算机的端口4000映射到容器的已发布端口80：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 4000:80 friendlyhello</span><br></pre></td></tr></table></figure>

<p>使用curl访问app，运行结果如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> fangkui@fangkui-linux: ~</span></span><br><span class="line">ζ curl http://localhost:4000/</span><br><span class="line">&lt;h3&gt;Hello World!&lt;/h3&gt;&lt;b&gt;Hostname:&lt;/b&gt; 1e4ace406b41&lt;br/&gt;&lt;b&gt;Visits:&lt;/b&gt; &lt;i&gt;cannot connect to Redis, counter disabled&lt;/i&gt;</span><br></pre></td></tr></table></figure>

<p>可以通过添加-d选项，让容器运行于后台：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 4000:80 friendlyhello</span><br><span class="line"></span><br><span class="line">717fd03233dc6084724d13c18707b8d5c67694f8001b2f26724adce4216ac5df</span><br></pre></td></tr></table></figure>

<p>您可以使用docker container ls查看缩写的容器ID：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> fangkui@fangkui-linux: ~/tmp                                                                           (17:33:45)  </span></span><br><span class="line">ζ docker container ls</span><br><span class="line"></span><br><span class="line">CONTAINER ID        IMAGE                  COMMAND             CREATED             STATUS              PORTS                  NAMES</span><br><span class="line">717fd03233dc        friendlyhello:latest   "python app.py"     40 seconds ago      Up 38 seconds       0.0.0.0:4000-&gt;80/tcp   romantic_einstein</span><br></pre></td></tr></table></figure>

<h3 id="Recap-and-cheat-sheet-optional"><a href="#Recap-and-cheat-sheet-optional" class="headerlink" title="Recap and cheat sheet (optional)"></a>Recap and cheat sheet (optional)</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">docker build -t friendlyhello .  # Create image using this directory's Dockerfile</span><br><span class="line">docker run -p 4000:80 friendlyhello  # Run "friendlyname" mapping port 4000 to 80</span><br><span class="line">docker run -d -p 4000:80 friendlyhello         # Same thing, but in detached mode</span><br><span class="line">docker container ls                                # List all running containers</span><br><span class="line">docker container ls -a             # List all containers, even those not running</span><br><span class="line">docker container stop &lt;hash&gt;           # Gracefully stop the specified container</span><br><span class="line">docker container kill &lt;hash&gt;         # Force shutdown of the specified container</span><br><span class="line">docker container rm &lt;hash&gt;        # Remove specified container from this machine</span><br><span class="line">docker container rm $(docker container ls -a -q)         # Remove all containers</span><br><span class="line">docker image ls -a                             # List all images on this machine</span><br><span class="line">docker image rm &lt;image id&gt;            # Remove specified image from this machine</span><br><span class="line">docker image rm $(docker image ls -a -q)   # Remove all images from this machine</span><br><span class="line">docker login             # Log in this CLI session using your Docker credentials</span><br><span class="line">docker tag &lt;image&gt; username/repository:tag  # Tag &lt;image&gt; for upload to registry</span><br><span class="line">docker push username/repository:tag            # Upload tagged image to registry</span><br><span class="line">docker run username/repository:tag                   # Run image from a registry</span><br></pre></td></tr></table></figure>

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><blockquote>
<p><a href="https://docs.docker.com/get-started/part2/#recap-and-cheat-sheet-optional">https://docs.docker.com/get-started/part2/#recap-and-cheat-sheet-optional</a></p>
</blockquote>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-08-28T06:38:49.000Z">2018-08-28</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    4 minutes read (About 554 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/08/28/Docker%E5%85%A5%E9%97%A8/">Docker入门-第一篇</a>
            
        </h1>
        <div class="content">
            <h1 id="Docker-基础知识"><a href="#Docker-基础知识" class="headerlink" title="Docker 基础知识"></a>Docker 基础知识</h1><h2 id="Docker-concepts"><a href="#Docker-concepts" class="headerlink" title="Docker concepts"></a>Docker concepts</h2><p>Docker是开发人员和系统管理员使用容器开发，部署和运行应用程序的平台。使用Linux容器部署应用程序称为容器化。</p>
<p>容器化越来越受欢迎的原因主要有一下几点：</p>
<ul>
<li>灵活（Flexible）：即使是最复杂的应用也可以集装箱化。</li>
<li>轻量级（Lightweight）：容器利用并共享主机内核。</li>
<li>可互换（Interchangeable）：您可以即时部署更新和升级。</li>
<li>便携式（Portable）：您可以在本地构建，部署到云，并在任何地方运行。</li>
<li>可扩展（Scalable）：您可以增加并自动分发容器副本。</li>
<li>可堆叠（Stackable）：您可以垂直和即时堆叠服务。</li>
</ul>
<h2 id="Images-and-containers"><a href="#Images-and-containers" class="headerlink" title="Images and containers"></a>Images and containers</h2><p>通过运行映像启动容器。映像是一个可执行包，包含运行应用程序所需的所有内容（代码，运行时，库，环境变量和配置文件）。</p>
<p><strong>容器</strong> 是运行时 <strong>镜像</strong>的实例，包括镜像在执行时保存在内存中的信息（状态镜像，或者用户进程）。您可以使用命令<strong>docker ps</strong>查看正在运行的容器列表，就像在Linux中一样。</p>
<div align=center style="width:100%">
<div style="float:left; width:45%;margin-right:10%">
![Container](/images/Container@2x.png)
</div><div style="float:left; width:45%">
![VM](/images/VM@2x.png)
</div>
</div>

<h2 id="Containers-and-virtual-machines"><a href="#Containers-and-virtual-machines" class="headerlink" title="Containers and virtual machines"></a>Containers and virtual machines</h2><p><strong>容器</strong>在Linux上本机运行，并与其他容器共享主机的内核。它运行一个独立的进程，不占用任何其他可执行文件的内存，使其轻量级。相比之下，<strong>虚拟机（VM）</strong>运行一个完整的“客户”操作系统，通过虚拟机管理程序对主机资源进行虚拟访问。通常，VM提供的环境比大多数应用程序需要的资源更多。</p>
<h2 id="Recap-and-cheat-sheet"><a href="#Recap-and-cheat-sheet" class="headerlink" title="Recap and cheat sheet"></a>Recap and cheat sheet</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># List Docker CLI commands</span></span></span><br><span class="line">docker</span><br><span class="line">docker container --help</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Display Docker version and info</span></span></span><br><span class="line">docker --version</span><br><span class="line">docker version</span><br><span class="line">docker info</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Execute Docker image</span></span></span><br><span class="line">docker run hello-world</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># List Docker images</span></span></span><br><span class="line">docker image ls</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># List Docker containers (running, all, all in quiet mode)</span></span></span><br><span class="line">docker container ls</span><br><span class="line">docker container ls --all</span><br><span class="line">docker container ls -aq</span><br></pre></td></tr></table></figure>

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><blockquote>
<p><a href="https://docs.docker.com/get-started/#conclusion-of-part-one">https://docs.docker.com/get-started/#conclusion-of-part-one</a></p>
</blockquote>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-08-27T05:33:13.000Z">2018-08-27</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    6 minutes read (About 941 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/08/27/Ubuntu-16-04-or-later-%E7%89%88%E6%9C%AC%E6%B7%BB%E5%8A%A0Tomcat%E4%B8%BA%E6%9C%8D%E5%8A%A1/">Ubuntu 16.04 or later 版本添加Tomcat为服务</a>
            
        </h1>
        <div class="content">
            <h1 id="Ubuntu16-04-or-later版本中Tomcat的安装"><a href="#Ubuntu16-04-or-later版本中Tomcat的安装" class="headerlink" title="Ubuntu16.04 or later版本中Tomcat的安装"></a>Ubuntu16.04 or later版本中Tomcat的安装</h1><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><h3 id="Step-1：JDK安装和Tomcat安装"><a href="#Step-1：JDK安装和Tomcat安装" class="headerlink" title="Step 1：JDK安装和Tomcat安装"></a>Step 1：JDK安装和Tomcat安装</h3><p>基本要求不用多说，需要下载适合Tomcat版本的JDK。具体JDK的安装方法可自行移步搜索引擎查找方法。然后便是下载合适版本的Tomcat，解压到合适的目录。记住自己JDK安装目录，和Tomcat存放目录。笔者的JDK版本为1.8.0_172, Tomcat版本为9.0。JDK目录为 <strong>~/DevelopTools/jdk1.8.0_172</strong>，Tomcat目录为 <strong>/opt/tomcat9</strong>。</p>
<h3 id="Step-2-创建Tomcat用户"><a href="#Step-2-创建Tomcat用户" class="headerlink" title="Step 2: 创建Tomcat用户"></a>Step 2: 创建Tomcat用户</h3><p>出于安全考虑，Tomcat应该作为非特权用户运行（即不是root用户）。我们将创建一个将运行Tomcat服务的新用户和组。</p>
<p>首先创建一个新的 <strong>tomcat</strong> 用户组：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo groupadd tomcat</span><br></pre></td></tr></table></figure>

<p>然后创建名为 <strong>tomcat</strong> 的用户，并把该用户添加到刚刚创建的 <strong>tomcat</strong> 用户组当中。设置用户的home目录为tomcat安装目录，这里笔者设置为 <strong>/opt/tomcat9</strong>。最后需要设置shell为 <strong>/bin/false</strong> 防止 <strong>tomcat</strong> 用户获取shell。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> notice：change the dir according to your installation structure</span></span><br><span class="line">sudo useradd -s /bin/false -g tomcat -d /opt/tomcat9 tomcat</span><br></pre></td></tr></table></figure>

<h3 id="Step-3-修改文件夹权限"><a href="#Step-3-修改文件夹权限" class="headerlink" title="Step 3: 修改文件夹权限"></a>Step 3: 修改文件夹权限</h3><p>我们设置的tomcat用户需要能够访问Tomcat安装目录。切换到我们解压缩Tomcat安装的目录，将tomcat安装目录所属用户组设置为 <strong>tomcat</strong> 用户组：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> notice：change the dir according to your installation structure</span></span><br><span class="line">sudo chgrp -R tomcat /opt/tomcat9</span><br></pre></td></tr></table></figure>

<p>修改 <strong>conf</strong> 目录中文件的权限，使得tomcat用户组有可读权限，并且修改 <strong>conf</strong> 权限使得tomcat组有可执行权限：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> notice：change the dir according to your installation structure</span></span><br><span class="line">cd /opt/tomcat9</span><br><span class="line">sudo chmod -R g+r conf</span><br><span class="line">sudo chmod g+x conf</span><br></pre></td></tr></table></figure>

<p>最后还需要修改  <strong>webapps</strong>, <strong>work</strong>, <strong>temp</strong>, 和 <strong>logs</strong> 目录的所有者为tomcat：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> notice：change the dir according to your installation structure</span></span><br><span class="line">cd /opt/tomcat9</span><br><span class="line">sudo chown -R tomcat webapps/ work/ temp/ logs/</span><br></pre></td></tr></table></figure>

<h3 id="Step-4-创建系统服务文件"><a href="#Step-4-创建系统服务文件" class="headerlink" title="Step 4: 创建系统服务文件"></a>Step 4: 创建系统服务文件</h3><p>我们希望能够将Tomcat作为服务运行，因此我们将设置systemd服务文件。在 <strong>/etc/systemd/system</strong>目录下创建名为 <strong>tomcat.service</strong>的文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/systemd/system/tomcat.service</span><br></pre></td></tr></table></figure>

<p>将以下内容粘贴到 <strong>tomcat.service</strong> 文件中。如有必要，修改JAVA_HOME的值以匹配您在系统上找到的值。您可能还想修改CATALINA_OPTS中指定的内存分配设置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Apache Tomcat Web Application Container</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line"></span><br><span class="line">Environment=JAVA_HOME=/home/fangkui/DevelopTools/jdk1.8.0_172/jre</span><br><span class="line">Environment=CATALINA_PID=/opt/tomcat9/temp/tomcat.pid</span><br><span class="line">Environment=CATALINA_HOME=/opt/tomcat9</span><br><span class="line">Environment=CATALINA_BASE=/opt/tomcat9</span><br><span class="line">Environment='CATALINA_OPTS=-Xms512M -Xmx1024M -server -XX:+UseParallelGC'</span><br><span class="line">Environment='JAVA_OPTS=-Djava.awt.headless=true -Djava.security.egd=file:/dev/./urandom'</span><br><span class="line"></span><br><span class="line">ExecStart=/opt/tomcat/bin/startup.sh</span><br><span class="line">ExecStop=/opt/tomcat/bin/shutdown.sh</span><br><span class="line"></span><br><span class="line">User=tomcat</span><br><span class="line">Group=tomcat</span><br><span class="line">UMask=0007</span><br><span class="line">RestartSec=10</span><br><span class="line">Restart=always</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>然后保存文件。</p>
<p>接下来，重新加载systemd守护程序，以便它知道我们的服务文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br></pre></td></tr></table></figure>

<p>键入以下命令启动Tomcat服务：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start tomcat</span><br></pre></td></tr></table></figure>

<p>键入以下内容，仔细检查它是否正常启动：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status tomcat</span><br></pre></td></tr></table></figure>

<p>正常执行结果如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">● tomcat.service - Apache Tomcat Web Application Container</span><br><span class="line">   Loaded: loaded (/etc/systemd/system/tomcat.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Mon 2018-08-27 13:28:03 CST; 1h 4min ago</span><br><span class="line">  Process: 1485 ExecStart=/opt/tomcat9/bin/startup.sh (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 1629 (java)</span><br><span class="line">    Tasks: 49 (limit: 4915)</span><br><span class="line">   CGroup: /system.slice/tomcat.service</span><br><span class="line">           └─1629 /home/fangkui/DevelopTools/jdk1.8.0_172/jre/bin/java -Djava.util.logging.config.file=/opt/tomcat9/c</span><br><span class="line"></span><br><span class="line">8月 27 13:28:02 fangkui-linux systemd[1]: Starting Apache Tomcat Web Application Container...</span><br><span class="line">8月 27 13:28:03 fangkui-linux systemd[1]: Started Apache Tomcat Web Application Container.</span><br><span class="line">lines 1-11/11 (END)</span><br></pre></td></tr></table></figure>

<p>可以看到服务中的 <strong>active (running)</strong>字样</p>
<p>如果启动无误，就可以将服务添加到自动启动中了：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable tomcat</span><br></pre></td></tr></table></figure>

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><blockquote>
<p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-apache-tomcat-8-on-ubuntu-16-04">https://www.digitalocean.com/community/tutorials/how-to-install-apache-tomcat-8-on-ubuntu-16-04</a><br><a href="https://devops.profitbricks.com/tutorials/how-to-install-and-configure-tomcat-8-on-ubuntu-1604/">https://devops.profitbricks.com/tutorials/how-to-install-and-configure-tomcat-8-on-ubuntu-1604/</a></p>
</blockquote>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-08-20T05:29:12.000Z">2018-08-20</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    4 minutes read (About 670 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/08/20/spring-boot-profile%E4%B8%8Emaven-profile%E6%95%B4%E5%90%88/">spring boot profile与maven profile整合</a>
            
        </h1>
        <div class="content">
            <h1 id="Maven-Profile与Spring-Profile的整合"><a href="#Maven-Profile与Spring-Profile的整合" class="headerlink" title="Maven Profile与Spring Profile的整合"></a>Maven Profile与Spring Profile的整合</h1><h2 id="动机"><a href="#动机" class="headerlink" title="动机"></a>动机</h2><p>往往一个项目在开发、QA、生产环境的配置是不同的。开始接触maven管理项目时，没有使用过profile。所以自己开发的第一个项目在开发和部署的时候通过手动修改所有配置，比较麻烦。导致我打包部署后，无法再进行开发环境的测试。</p>
<h2 id="配置过程"><a href="#配置过程" class="headerlink" title="配置过程"></a>配置过程</h2><h3 id="Spring-Profile配置"><a href="#Spring-Profile配置" class="headerlink" title="Spring Profile配置"></a>Spring Profile配置</h3><p>由于最新配置文件推荐使用yml格式，所以笔者创建的上下文配置文件如下：</p>
<ul>
<li>application.yml spring 主配置文件，不管激活那个profile都会被读取并生效，需要在这个配置文件里面设置激活的profile；</li>
<li>application-dev.yml 开发环境配置文件，命名方式必须为application-{profilename}.yml，不然无法辨别属于哪个profile的配置文件；</li>
<li>application-prod.yml 生产环境配置文件。</li>
</ul>
<p>application.yml 文件中必须配置需要激活的profile名称，配置方式如下：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure>

<h3 id="maven配置"><a href="#maven配置" class="headerlink" title="maven配置"></a>maven配置</h3><ol>
<li><p>在pom.xml中添加profiles，配置方式如下：</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">id</span>&gt;</span> <span class="comment">&lt;!--profile id，用于在maven命令行中唯一标识一个profile配置项--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span> <span class="comment">&lt;!--profile激活后，各个参数对应的值，可以在资源文件导入一下配置的properties--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">profileActive</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">profileActive</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">quartz.URL</span>&gt;</span>×××<span class="tag">&lt;/<span class="name">quartz.URL</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">quartz.user</span>&gt;</span>×××<span class="tag">&lt;/<span class="name">quartz.user</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">qurtz.password</span>&gt;</span>×××<span class="tag">&lt;/<span class="name">qurtz.password</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activation</span>&gt;</span> <span class="comment">&lt;!--指定默认激活--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>添加资源过滤，控制激活不同profile之后，哪些资源文件是必要加载的和没必要加载的：</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span><span class="comment">&lt;!--资源路径--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span> <span class="comment">&lt;!--是否需要额外处理--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">excludes</span>&gt;</span> <span class="comment">&lt;!--排除部分资源文件--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>application-dev.yml<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>application-prod.yml<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includes</span>&gt;</span> <span class="comment">&lt;!--加载必要资源文件--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>application-$&#123;profileActive&#125;.yml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在pom.xml中指定profile中的properties属性读取方式，需要添加插件 <strong>maven-resources-plugin</strong>，具体配置如下：</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-resources-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">delimiters</span>&gt;</span> <span class="comment">&lt;!--指定读取properties的特殊标志符号--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">delimiter</span>&gt;</span>@<span class="tag">&lt;/<span class="name">delimiter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">delimiters</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>通过以上配置，就可在其他作为资源文件的配置文件中读取properties中配置的属性，具体做法为在需要的地方添加 <strong>@property@</strong>。</p>
</li>
</ol>
<h3 id="修改application-yml"><a href="#修改application-yml" class="headerlink" title="修改application.yml"></a>修改application.yml</h3><p>在前面的配置中，我们直接硬编码指定了spring激活的profile。通过maven profile中的properties设置，我们可以直接用maven进行控制激活的profile。只需要修改激活profile的参数值为@profileActive@，修改后的application.yml如下：</p>
<pre><code><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">@profileActive@</span></span><br></pre></td></tr></table></figure></code></pre><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>通过maven的profile中properties属性，我们还可以直接控制log4j中的配置，只需要通过引入参数就行了。</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><blockquote>
<p><a href="https://blog.csdn.net/lihe2008125/article/details/50443491">https://blog.csdn.net/lihe2008125/article/details/50443491</a></p>
</blockquote>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-08-20T03:49:48.000Z">2018-08-20</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 minutes read (About 471 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/08/20/Hexo-Next-%E9%85%8D%E7%BD%AEgitment%E6%8F%92%E4%BB%B6/">Hexo Next 配置gitment插件</a>
            
        </h1>
        <div class="content">
            <h1 id="Gitment插件配置"><a href="#Gitment插件配置" class="headerlink" title="Gitment插件配置"></a>Gitment插件配置</h1><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>由于笔者在定义文章名字时文章名太长，所以会导致评论初始化不成功。根据网上大佬的解答，是因为gitment产生的评论是通过github repo issue进行记录的。但是issue的label字符长度不能超过50。<br>而next主题默认label获取方式为：<strong>window.location.pathname</strong>，很容易超过长度限制。</p>
<h2 id="解决方式"><a href="#解决方式" class="headerlink" title="解决方式"></a>解决方式</h2><p>还是根据网上大佬们提供的方案，可以对 <strong>window.location.pathname</strong> 的值进行MD5编码，这样得到的结果可以保证长度不超过限制。具体方法如下，这里我使用的Next主题版本为 <strong>6.3.0</strong></p>
<ul>
<li><p>找到Next引入gitment的代码所在文件，在 <strong>6.3.0</strong>版本中该文件路径为：<strong>/next/layout/_third-party/comments/gitment.swig</strong></p>
</li>
<li><p>在文件中引入第三方MD5编码工具包：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if theme.gitment.enable and theme.gitment.client_id %&#125;</span><br><span class="line">    &lt;script</span><br><span class="line">    src&#x3D;&quot;https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;blueimp-md5&#x2F;1.1.0&#x2F;js&#x2F;md5.js&quot;&gt;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>对 <strong>window.location.pathname</strong>进行MD5编码，具体方法为找到上面文件中设置id字段值的地方，然后替换为 <strong>md5(window.location.pathname)</strong>修改后的文件内容如下：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if theme.gitment.enable and theme.gitment.client_id %&#125;</span><br><span class="line">    &lt;script</span><br><span class="line">    src&#x3D;&quot;https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;blueimp-md5&#x2F;1.1.0&#x2F;js&#x2F;md5.js&quot;&gt;&lt;&#x2F;script&gt; </span><br><span class="line">&lt;!-- LOCAL: You can save these files to your site and update links --&gt;</span><br><span class="line">    &#123;% if theme.gitment.mint %&#125;</span><br><span class="line">        &#123;% set CommentsClass &#x3D; &quot;Gitmint&quot; %&#125;</span><br><span class="line">        &lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;https:&#x2F;&#x2F;aimingoo.github.io&#x2F;gitmint&#x2F;style&#x2F;default.css&quot;&gt;</span><br><span class="line">        &lt;script src&#x3D;&quot;https:&#x2F;&#x2F;aimingoo.github.io&#x2F;gitmint&#x2F;dist&#x2F;gitmint.browser.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">    &#123;% else %&#125;</span><br><span class="line">        &#123;% set CommentsClass &#x3D; &quot;Gitment&quot; %&#125;</span><br><span class="line">        &lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;https:&#x2F;&#x2F;imsun.github.io&#x2F;gitment&#x2F;style&#x2F;default.css&quot;&gt;</span><br><span class="line">        &lt;script src&#x3D;&quot;https:&#x2F;&#x2F;imsun.github.io&#x2F;gitment&#x2F;dist&#x2F;gitment.browser.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">&lt;!-- END LOCAL --&gt;</span><br><span class="line"></span><br><span class="line">    &#123;% if theme.gitment.cleanly %&#125;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        a.gitment-editor-footer-tip &#123; display: none; &#125;</span><br><span class="line">        .gitment-container.gitment-footer-container &#123; display: none; &#125;</span><br><span class="line">    &lt;&#x2F;style&gt;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">    &#123;% if page.comments %&#125;</span><br><span class="line">    &lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class="line">    function renderGitment()&#123;</span><br><span class="line">        var gitment &#x3D; new &#123;&#123;CommentsClass&#125;&#125;(&#123;</span><br><span class="line">            id: md5(window.location.pathname),</span><br><span class="line">            owner: &#39;&#123;&#123; theme.gitment.github_user &#125;&#125;&#39;,</span><br><span class="line">            repo: &#39;&#123;&#123; theme.gitment.github_repo &#125;&#125;&#39;,</span><br><span class="line">            &#123;% if theme.gitment.mint %&#125;</span><br><span class="line">            lang: &quot;&#123;&#123; theme.gitment.language &#125;&#125;&quot; || navigator.language || navigator.systemLanguage || navigator.userLanguage,</span><br><span class="line">            &#123;% endif %&#125;</span><br><span class="line">            oauth: &#123;</span><br><span class="line">            &#123;% if theme.gitment.mint and theme.gitment.redirect_protocol %&#125;</span><br><span class="line">                redirect_protocol: &#39;&#123;&#123; theme.gitment.redirect_protocol &#125;&#125;&#39;,</span><br><span class="line">            &#123;% endif %&#125;</span><br><span class="line">            &#123;% if theme.gitment.mint and theme.gitment.proxy_gateway %&#125;</span><br><span class="line">                proxy_gateway: &#39;&#123;&#123; theme.gitment.proxy_gateway &#125;&#125;&#39;,</span><br><span class="line">            &#123;% else %&#125;</span><br><span class="line">                client_secret: &#39;&#123;&#123; theme.gitment.client_secret &#125;&#125;&#39;,</span><br><span class="line">            &#123;% endif %&#125;</span><br><span class="line">                client_id: &#39;&#123;&#123; theme.gitment.client_id &#125;&#125;&#39;</span><br><span class="line">            &#125;&#125;);</span><br><span class="line">        gitment.render(&#39;gitment-container&#39;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#123;% if not theme.gitment.lazy %&#125;</span><br><span class="line">    renderGitment();</span><br><span class="line">    &#123;% else %&#125;</span><br><span class="line">    function showGitment()&#123;</span><br><span class="line">        document.getElementById(&quot;gitment-display-button&quot;).style.display &#x3D; &quot;none&quot;;</span><br><span class="line">        document.getElementById(&quot;gitment-container&quot;).style.display &#x3D; &quot;block&quot;;</span><br><span class="line">        renderGitment();</span><br><span class="line">    &#125;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">    &lt;&#x2F;script&gt;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><blockquote>
<p><a href="https://www.v2ex.com/t/381246">https://www.v2ex.com/t/381246</a></p>
</blockquote>

        </div>
        
        
        
    </div>
</div>









    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous is-invisible is-hidden-mobile">
            <a class="is-flex-grow has-text-black-ter" href="/page/0/">Previous</a>
        </div>
        <div class="pagination-next">
            <a class="is-flex-grow has-text-black-ter" href="/page/2/">Next</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link is-current" href="/">1</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/2/">2</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/3/">3</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/4/">4</a></li>
            
        </ul>
    </nav>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="" src="/images/WechatIMG32.jpeg" alt="NatsumeHill">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        NatsumeHill
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Nube
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Spcae</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Posts
                    </p>
                    <a href="/archives">
                        <p class="title has-text-weight-normal">
                            32
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Categories
                    </p>
                    <a href="/categories">
                        <p class="title has-text-weight-normal">
                            0
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Tags
                    </p>
                    <a href="/tags">
                        <p class="title has-text-weight-normal">
                            27
                        </p>
                    </a>
                </div>
            </div>
        </nav>
        
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/NatsumeHill" target="_blank" rel="noopener">
                Follow</a>
        </div>
        
        
        
    </div>
</div>
    
        
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Tag Cloud
        </h3>
        <a href="/tags/HTTPS-openSSL/" style="font-size: 10px;">-HTTPS -openSSL</a> <a href="/tags/CNN/" style="font-size: 10px;">CNN</a> <a href="/tags/DL/" style="font-size: 10px;">DL</a> <a href="/tags/Docker/" style="font-size: 12.5px;">Docker</a> <a href="/tags/ElasticSearch/" style="font-size: 17.5px;">ElasticSearch</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/JDBC/" style="font-size: 10px;">JDBC</a> <a href="/tags/Java/" style="font-size: 12.5px;">Java</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/Mybatis/" style="font-size: 10px;">Mybatis</a> <a href="/tags/Next/" style="font-size: 10px;">Next</a> <a href="/tags/Node-js/" style="font-size: 10px;">Node.js</a> <a href="/tags/OS/" style="font-size: 10px;">OS</a> <a href="/tags/OpenWAF/" style="font-size: 10px;">OpenWAF</a> <a href="/tags/Spring/" style="font-size: 10px;">Spring</a> <a href="/tags/Spring-Boot/" style="font-size: 10px;">Spring Boot</a> <a href="/tags/Tensorflow/" style="font-size: 10px;">Tensorflow</a> <a href="/tags/Tomcat-%E5%AE%89%E8%A3%85/" style="font-size: 10px;">Tomcat 安装</a> <a href="/tags/Ubuntu/" style="font-size: 10px;">Ubuntu</a> <a href="/tags/WAF/" style="font-size: 10px;">WAF</a> <a href="/tags/Web/" style="font-size: 10px;">Web</a> <a href="/tags/WebSocket/" style="font-size: 10px;">WebSocket</a> <a href="/tags/maven/" style="font-size: 10px;">maven</a> <a href="/tags/%E4%BA%8B%E5%8A%A1/" style="font-size: 10px;">事务</a> <a href="/tags/%E4%BB%A3%E7%90%86/" style="font-size: 10px;">代理</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6%E5%8F%8A%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">前端框架及工具</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size: 20px;">学习笔记</a>
    </div>
</div>
    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recent
        </h3>
        
        <article class="media">
            
            <a href="/2019/09/03/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/gallery/thumbnails/wallhaven-lmk1vq.png" alt="数据库事务">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-09-03T06:41:55.000Z">2019-09-03</time></div>
                    <a href="/2019/09/03/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1/" class="title has-link-black-ter is-size-6 has-text-weight-normal">数据库事务</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/08/29/Mybatis-Note/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Mybatis Note">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-08-29T08:05:43.000Z">2019-08-29</time></div>
                    <a href="/2019/08/29/Mybatis-Note/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Mybatis Note</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/12/01/openssl-cook-book/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Openssl Cook Book">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-12-01T05:57:05.000Z">2018-12-01</time></div>
                    <a href="/2018/12/01/openssl-cook-book/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Openssl Cook Book</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/08/28/Docker%E5%85%A5%E9%97%A8-%E7%AC%AC%E5%9B%9B%E7%AF%87%EF%BC%88Swarms%EF%BC%89/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Docker入门-第四篇（Swarms）">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-08-28T12:17:59.000Z">2018-08-28</time></div>
                    <a href="/2018/08/28/Docker%E5%85%A5%E9%97%A8-%E7%AC%AC%E5%9B%9B%E7%AF%87%EF%BC%88Swarms%EF%BC%89/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Docker入门-第四篇（Swarms）</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/08/28/Docker%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%89%E7%AF%87%EF%BC%88Services%EF%BC%89/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Docker入门-第三篇（Services）">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-08-28T09:51:19.000Z">2018-08-28</time></div>
                    <a href="/2018/08/28/Docker%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%89%E7%AF%87%EF%BC%88Services%EF%BC%89/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Docker入门-第三篇（Services）</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archives
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2019/09/">
                <span class="level-start">
                    <span class="level-item">September 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/08/">
                <span class="level-start">
                    <span class="level-item">August 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/12/">
                <span class="level-start">
                    <span class="level-item">December 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">August 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">11</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">July 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/06/">
                <span class="level-start">
                    <span class="level-item">June 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/05/">
                <span class="level-start">
                    <span class="level-item">May 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/04/">
                <span class="level-start">
                    <span class="level-item">April 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">March 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recent
        </h3>
        
        <article class="media">
            
            <a href="/2019/09/03/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/gallery/thumbnails/wallhaven-lmk1vq.png" alt="数据库事务">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-09-03T06:41:55.000Z">2019-09-03</time></div>
                    <a href="/2019/09/03/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1/" class="title has-link-black-ter is-size-6 has-text-weight-normal">数据库事务</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/08/29/Mybatis-Note/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Mybatis Note">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-08-29T08:05:43.000Z">2019-08-29</time></div>
                    <a href="/2019/08/29/Mybatis-Note/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Mybatis Note</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/12/01/openssl-cook-book/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Openssl Cook Book">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-12-01T05:57:05.000Z">2018-12-01</time></div>
                    <a href="/2018/12/01/openssl-cook-book/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Openssl Cook Book</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/08/28/Docker%E5%85%A5%E9%97%A8-%E7%AC%AC%E5%9B%9B%E7%AF%87%EF%BC%88Swarms%EF%BC%89/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Docker入门-第四篇（Swarms）">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-08-28T12:17:59.000Z">2018-08-28</time></div>
                    <a href="/2018/08/28/Docker%E5%85%A5%E9%97%A8-%E7%AC%AC%E5%9B%9B%E7%AF%87%EF%BC%88Swarms%EF%BC%89/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Docker入门-第四篇（Swarms）</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/08/28/Docker%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%89%E7%AF%87%EF%BC%88Services%EF%BC%89/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Docker入门-第三篇（Services）">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-08-28T09:51:19.000Z">2018-08-28</time></div>
                    <a href="/2018/08/28/Docker%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%89%E7%AF%87%EF%BC%88Services%EF%BC%89/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Docker入门-第三篇（Services）</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archives
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2019/09/">
                <span class="level-start">
                    <span class="level-item">September 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/08/">
                <span class="level-start">
                    <span class="level-item">August 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/12/">
                <span class="level-start">
                    <span class="level-item">December 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">August 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">11</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">July 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/06/">
                <span class="level-start">
                    <span class="level-item">June 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/05/">
                <span class="level-start">
                    <span class="level-item">May 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/04/">
                <span class="level-start">
                    <span class="level-item">April 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">March 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.svg" alt="NatsumeHill&#39;s blog" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2020 NatsumeHill&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("en");</script>


<script>
var IcarusThemeSettings = {
    site: {
        url: 'https://natsumehill.github.io',
        external_link: {"enable":true,"exclude":[]}
    },
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>





<script src="/js/animation.js"></script>



<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>



<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>


<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>














<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>